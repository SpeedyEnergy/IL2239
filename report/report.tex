\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{hyperref}
\usepackage{tikz}
  \usetikzlibrary{shapes, calc, intersections, spy}
\usepackage{pgfplots}
  \pgfplotsset{compat=1.16}
\usepackage{circuitikz}
\usepackage{siunitx}

\tikzset{new spy style/.style={spy scope={%
 magnification=5,
 size=1.25cm, 
 connect spies,
 every spy on node/.style={rectangle,draw},
 every spy in node/.style={draw,rectangle,fill=gray!40}
}}}

\newcommand*{\subb}[1]{\ensuremath{_{\mathrm{#1}}}}
\newcommand*{\supp}[1]{\ensuremath{^{\mathrm{#1}}}}
\renewcommand*{\j}{\ensuremath{{\mathrm{j}}}}

\title{IL2239 Course Project}
\author{Jordi Altayó \\\texttt{jordiag@kth.se}\and Björn Sunedahl\\\texttt{bjorn@kth.se}}
\date{January 2019}

% please, use 1 space as indentation
\begin{document}
 \maketitle
 \section*{Introduction}
 \section*{Milestone 1}
 \subsection*{Transient analysis}
 \begin{figure}[h]
  \centering
  \caption{Transient analysis of the SAR comparator}
  \label{fig:transient}
  \begin{tikzpicture}[trim axis left, trim axis right]
   \begin{axis}[
     x filter/.code={\pgfmathdivide{#1}{1e-9}},
     width=\textwidth,
     enlarge x limits=0,
     xlabel=\si{\ns},
     ylabel=\si{\V},
     legend cell align={left},
     grid=both, minor grid style=dotted, minor y tick num = 5, minor x tick num=3,
    ]
    \addplot [thick, red] table[x=/input X, y=/input Y, col sep=comma] {./data/m1_transient.csv};
    \addlegendentry{Input};
    \addplot [thick, blue] table[x=/reference X, y=/reference Y, col sep=comma] {./data/m1_transient.csv};
    \addlegendentry{Reference};
    \addplot [thick, green] table[x=/outn X, y=/outn Y, col sep=comma] {./data/m1_transient.csv};
    \addlegendentry{Output};
   \end{axis}
  \end{tikzpicture}
 \end{figure}

 \subsection*{Kickback simulation}
 \begin{figure}[h]
  \centering
  \caption{Close-up on the kickback noise effects}
  \label{fig:kickback_closeup}
  \begin{tikzpicture}[trim axis left, trim axis right, new spy style]
   \begin{axis}[
     x filter/.code={\pgfmathdivide{#1}{1e-9}},
     width=\textwidth,
     enlarge x limits=0,
     xlabel=\si{\ns},
     ylabel=\si{\V},
     legend cell align={left},
     grid=both, minor grid style=dotted, minor y tick num = 4, minor x tick num=3,
    ]
    \addplot [thick, orange] table[x=/CLK X, y=/CLK Y, col sep=comma] {./data/m1_kickback.csv};
    \addlegendentry{Clock};
    \addplot [thick, red] table[x=/input X, y=/input Y, col sep=comma] {./data/m1_kickback.csv};
    \addlegendentry{Input};
    \addplot [thick, blue] table[x=/reference X, y=/reference Y, col sep=comma] {./data/m1_kickback.csv};
    \addlegendentry{Reference};
    \addplot [thick, green] table[x=/outn X, y=/outn Y, col sep=comma] {./data/m1_kickback.csv};
    \addlegendentry{Output};
    \coordinate (spypoint) at (axis cs:5,0.95);
    \coordinate (spyloc) at (axis cs:7,0.3);
   \end{axis}
   \spy[size=2cm] on (spypoint) in node at (spyloc);
  \end{tikzpicture}
 \end{figure}
 \begin{figure}[h]
  \centering
  \caption{Differential error generated by the kickback}
  \label{fig:kickback_diff}
  \begin{tikzpicture}[trim axis left, trim axis right]
   \begin{axis}[
     x filter/.code={\pgfmathdivide{#1}{1e-9}},
     y filter/.code={\pgfmathdivide{#1}{1e-3}},
     width=\textwidth,
     enlarge x limits=0,
     xlabel=\si{\ns},
     ylabel=$V\subb{in}^+-V\subb{in}^-\,/\,\si{\mV}$,
     legend cell align={left},
     grid=both, minor grid style=dotted, minor y tick num = 4, minor x tick num=3,
    ]
    \addplot [thick, red] table[x=diff X, y=diff Y, col sep=comma] {./data/m1_kickback.csv};
    \draw[thick, dashed] (axis cs:10,500.62) --++ (axis direction cs:2,0);
    \draw[thick, dashed] (axis cs:15,505.82) --++ (axis direction cs:-3,0);
    \draw[latex-latex] (12,500.62) -- (12,505.82) node[midway, right] {Kickback};
   \end{axis}
  \end{tikzpicture}
 \end{figure}
 \subsection*{Noise simulation}
 \begin{figure}[h]
  \centering
  \caption{Transient analysis of the SAR comparator}
  \label{fig:transient}
  \begin{tikzpicture}[trim axis left, trim axis right]
   \begin{axis}[
     x filter/.code={\pgfmathdivide{#1}{1e-9}},
     width=\textwidth,
     enlarge x limits=0,
     xlabel=\si{\ns},
     ylabel=\si{\V},
     legend cell align={left},
     grid=both, minor grid style=dotted, minor y tick num = 5, minor x tick num=3,
    ]
    %\addplot [thick, red] table[x=/input X, y=/input Y, col sep=comma] {./data/m1_noise-0.01.csv};
    %\addlegendentry{Input};
    %\addplot [thick, blue] table[x=/reference X, y=/reference Y, col sep=comma] {./data/m1_noise-0.01.csv};
    %\addlegendentry{Reference};
    \addplot [thick, green] table[x=/outn X, y=/outn Y, col sep=comma] {./data/m1_noise-0.01.csv};
    \addlegendentry{Output};
   \end{axis}
  \end{tikzpicture}
 \end{figure}
 \begin{figure}[h]
  \centering
  \caption{Transient analysis of the SAR comparator}
  \label{fig:transient}
  \begin{tikzpicture}[trim axis left, trim axis right]
   \begin{axis}[
     x filter/.code={\pgfmathdivide{#1}{1e-9}},
     width=\textwidth,
     enlarge x limits=0,
     xlabel=\si{\ns},
     ylabel=\si{\V},
     legend cell align={left},
     grid=both, minor grid style=dotted, minor y tick num = 5, minor x tick num=3,
    ]
    %\addplot [thick, red] table[x=/input X, y=/input Y, col sep=comma] {./data/m1_noise-0.01.csv};
    %\addlegendentry{Input};
    %\addplot [thick, blue] table[x=/reference X, y=/reference Y, col sep=comma] {./data/m1_noise-0.01.csv};
    %\addlegendentry{Reference};
    \addplot [thick, green] table[x=/outn X, y=/outn Y, col sep=comma] {./data/m1_noise-0.05.csv};
    \addlegendentry{Output};
   \end{axis}
  \end{tikzpicture}
 \end{figure}
 \section*{Milestone 2}
 \section*{Milestone 3}
 \section*{Milestone 4}
\end{document}
